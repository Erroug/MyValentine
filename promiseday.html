<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Promise Day</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

<style>
/* ================= BACKGROUND ================= */
body {
  position: relative;
  margin: 0;
  min-height: 100dvh;
  background:
    radial-gradient(1200px 820px at 18% 12%, rgba(220, 245, 255, 0.98) 0%, rgba(148, 194, 255, 0.9) 40%, rgba(14, 26, 58, 0.98) 100%),
    linear-gradient(135deg, #9ec4ff 0%, #4e73c3 45%, #0e1a3a 100%);
  background-color: #0e1a3a;
  background-repeat: no-repeat;
  background-size: cover;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Playfair Display', serif;
  overflow: hidden;
}

.promise-bg {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  overflow: hidden;
}

.bg-orb {
  position: absolute;
  border-radius: 50%;
  filter: blur(8px);
  opacity: 0.55;
  animation: orbFloat 12s ease-in-out infinite;
}

.bg-orb.orb-1 {
  width: 340px;
  height: 340px;
  top: -110px;
  left: -90px;
  background: radial-gradient(circle, rgba(215, 244, 255, 0.9), rgba(215, 244, 255, 0));
}

.bg-orb.orb-2 {
  width: 420px;
  height: 420px;
  bottom: -140px;
  right: -120px;
  background: radial-gradient(circle, rgba(131, 176, 255, 0.75), rgba(131, 176, 255, 0));
  animation-delay: 2s;
}

.bg-orb.orb-3 {
  width: 280px;
  height: 280px;
  top: 18%;
  right: 16%;
  background: radial-gradient(circle, rgba(188, 226, 255, 0.78), rgba(188, 226, 255, 0));
  animation-delay: 4s;
}

.romance-hearts {
  position: absolute;
  inset: 0;
}

.romance-hearts span {
  position: absolute;
  bottom: -12%;
  font-size: clamp(14px, 1.8vw, 24px);
  filter: drop-shadow(0 0 10px rgba(255, 190, 220, 0.8));
  opacity: 0.72;
  animation: heartLift linear infinite;
}

.romance-hearts span:nth-child(1) { left: 6%; animation-duration: 12s; animation-delay: 0s; }
.romance-hearts span:nth-child(2) { left: 14%; animation-duration: 10.5s; animation-delay: 1.3s; }
.romance-hearts span:nth-child(3) { left: 23%; animation-duration: 11.8s; animation-delay: 2.7s; }
.romance-hearts span:nth-child(4) { left: 35%; animation-duration: 9.8s; animation-delay: 0.9s; }
.romance-hearts span:nth-child(5) { left: 47%; animation-duration: 12.3s; animation-delay: 3.1s; }
.romance-hearts span:nth-child(6) { left: 59%; animation-duration: 10.9s; animation-delay: 1.7s; }
.romance-hearts span:nth-child(7) { left: 70%; animation-duration: 11.5s; animation-delay: 2.1s; }
.romance-hearts span:nth-child(8) { left: 81%; animation-duration: 10.2s; animation-delay: 3.4s; }
.romance-hearts span:nth-child(9) { left: 90%; animation-duration: 12.8s; animation-delay: 1.1s; }

.promise-rings {
  position: absolute;
  inset: 0;
}

.promise-rings span {
  position: absolute;
  bottom: -12%;
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255, 255, 255, 0.85);
  border-radius: 50%;
  box-shadow: 0 0 14px rgba(180, 220, 255, 0.9);
  animation: promiseRingRise linear infinite;
}

.promise-rings span:nth-child(1) { left: 8%; animation-duration: 10s; animation-delay: 0s; }
.promise-rings span:nth-child(2) { left: 18%; animation-duration: 12s; animation-delay: 1.2s; }
.promise-rings span:nth-child(3) { left: 29%; animation-duration: 11s; animation-delay: 2.1s; }
.promise-rings span:nth-child(4) { left: 40%; animation-duration: 13s; animation-delay: 3s; }
.promise-rings span:nth-child(5) { left: 52%; animation-duration: 10.5s; animation-delay: 0.7s; }
.promise-rings span:nth-child(6) { left: 63%; animation-duration: 12.5s; animation-delay: 1.8s; }
.promise-rings span:nth-child(7) { left: 74%; animation-duration: 11.8s; animation-delay: 2.8s; }
.promise-rings span:nth-child(8) { left: 85%; animation-duration: 13.2s; animation-delay: 3.6s; }
.promise-rings span:nth-child(9) { left: 93%; animation-duration: 10.8s; animation-delay: 1.5s; }

@keyframes promiseRingRise {
  0% { transform: translateY(0) scale(0.75); opacity: 0; }
  15% { opacity: 0.9; }
  100% { transform: translateY(-120vh) scale(1.22); opacity: 0; }
}

@keyframes orbFloat {
  0% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-28px) scale(1.05); }
  100% { transform: translateY(0) scale(1); }
}

@keyframes heartLift {
  0% { transform: translateY(0) scale(0.8) rotate(0deg); opacity: 0; }
  15% { opacity: 0.76; }
  100% { transform: translateY(-118vh) scale(1.16) rotate(16deg); opacity: 0; }
}

/* ================= A4 CARD ================= */
.card {
  position: relative;
  z-index: 2;
  height: min(90vh, 860px);
  max-width: 78vw;
  aspect-ratio: 210 / 297;
  background:
    radial-gradient(160% 100% at 0% 0%, rgba(255, 245, 250, 0.98), rgba(255, 240, 248, 0.92) 45%, rgba(255, 231, 243, 0.9) 100%),
    linear-gradient(145deg, #fff8fd 0%, #ffe8f4 100%);
  border-radius: 24px;
  border: 1px solid rgba(255, 255, 255, 0.6);
  overflow: hidden;
  box-shadow: 0 38px 90px rgba(8,17,44,0.6), 0 0 50px rgba(255,140,190,0.2);
}

/* ================= INSIDE CONTENT (HIDDEN) ================= */
.card-content {
  position: absolute;
  inset: 0;
  padding: 48px 56px 30px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 10px;
  z-index: 1; /* BELOW canvas */
  background:
    radial-gradient(600px 300px at 50% -10%, rgba(255, 182, 217, 0.25), rgba(255, 182, 217, 0)),
    repeating-linear-gradient(45deg, rgba(255, 198, 222, 0.14) 0 2px, transparent 2px 10px);
}

.love-title-row {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0;
  margin-bottom: 0;
  position: relative;
}

.love-ring-photo {
  width: 170px;
  height: 170px;
  border-radius: 50%;
  overflow: hidden;
  border: 5px solid rgba(255, 255, 255, 0.95);
  box-shadow: 0 12px 30px rgba(177, 80, 132, 0.35);
  position: relative;
}

.love-script {
  margin: 0;
  font-size: clamp(36px, 3.4vw, 50px);
  font-family: "Brush Script MT", "Segoe Script", cursive;
  color: #bf4f88;
  letter-spacing: 0.8px;
  text-shadow: 0 6px 12px rgba(191, 79, 136, 0.25);
  white-space: nowrap;
  margin-top: -16px;
  position: relative;
  z-index: 2;
}

.love-ring-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: opacity 420ms ease;
}

.love-ring-overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  filter: drop-shadow(0 2px 2px rgba(255, 255, 255, 0.35));
}

.card-content p {
  margin: 0;
  width: min(100%, 560px);
  max-height: 34vh;
  overflow-y: auto;
  text-align: left;
  font-size: clamp(19px, 1.38vw, 24px);
  line-height: 1.65;
  color: #3a2332;
  background: rgba(255, 255, 255, 0.86);
  border: 1px solid rgba(235, 165, 201, 0.85);
  border-radius: 18px;
  padding: 24px 24px;
  box-shadow: 0 12px 26px rgba(180,95,130,0.14);
}

.card-content p::-webkit-scrollbar {
  width: 10px;
}

.card-content p::-webkit-scrollbar-thumb {
  background: rgba(214, 110, 165, 0.55);
  border-radius: 999px;
}

.card-content p::-webkit-scrollbar-track {
  background: rgba(255, 225, 240, 0.65);
  border-radius: 999px;
}

.love-stamp {
  margin-top: 2px;
  display: inline-block;
  font-size: 32px;
  letter-spacing: 6px;
  animation: pulseLove 1.8s ease-in-out infinite;
}

@media (max-width: 900px) {
  .card-content {
    padding: 24px 18px 18px;
  }

  .love-title-row {
    gap: 0;
    margin-bottom: 0;
  }

  .love-ring-photo {
    width: 128px;
    height: 128px;
  }

  .love-script {
    font-size: clamp(30px, 10vw, 42px);
    margin-top: -12px;
  }

  .card-content p {
    max-height: 38vh;
    font-size: clamp(17px, 4.6vw, 21px);
    line-height: 1.55;
    padding: 18px 16px;
  }
}

@keyframes pulseLove {
  0% { transform: scale(0.92); filter: drop-shadow(0 0 0 rgba(255,110,170,0)); }
  50% { transform: scale(1.08); filter: drop-shadow(0 0 14px rgba(255,110,170,0.5)); }
  100% { transform: scale(0.92); filter: drop-shadow(0 0 0 rgba(255,110,170,0)); }
}

/* ================= SCRATCH WRAP ================= */
#scratchCanvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 3;
  cursor: pointer;
  touch-action: none;
  animation: wrapperVibe 2.8s ease-in-out infinite;
}

@keyframes wrapperVibe {
  0% { filter: saturate(1) brightness(1); }
  50% { filter: saturate(1.14) brightness(1.06); }
  100% { filter: saturate(1) brightness(1); }
}

/* ================= CONFETTI ================= */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  z-index: 999;
  animation: fall 2.8s linear forwards;
}

@keyframes fall {
  to {
    transform: translateY(110vh) rotate(720deg);
    opacity: 0;
  }
}

.emoji-pop {
  position: fixed;
  z-index: 1000;
  font-size: clamp(24px, 2.8vw, 42px);
  pointer-events: none;
  animation: emojiBurst 1.4s ease-out forwards;
}

.next-btn {
  position: fixed;
  right: 22px;
  bottom: 22px;
  z-index: 20;
  padding: 12px 18px;
  border: 0;
  border-radius: 12px;
  background: linear-gradient(135deg, #ffffff 0%, #ffe7f3 100%);
  color: #3a2332;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(30, 12, 36, 0.35);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.next-btn:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 14px 28px rgba(30, 12, 36, 0.42);
}

@keyframes emojiBurst {
  0% {
    transform: translate(-50%, -50%) scale(0.6);
    opacity: 0;
  }
  15% {
    opacity: 1;
  }
  100% {
    transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1.15);
    opacity: 0;
  }
}
</style>
</head>

<body onload="checkAccess('2026-02-11','promise')">
<div class="promise-bg">
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>
  <div class="bg-orb orb-3"></div>
  <div class="romance-hearts">
    <span>&#10084;</span><span>&#128150;</span><span>&#128149;</span><span>&#128151;</span><span>&#128152;</span>
    <span>&#10084;</span><span>&#128158;</span><span>&#128147;</span><span>&#128157;</span>
  </div>
  <div class="promise-rings">
    <span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span>
  </div>
</div>

<div class="card">

  <!-- ‚ù§Ô∏è CONTENT (ONLY AFTER SCRATCH) -->
  <div class="card-content">
    <div class="love-title-row">
      <div class="love-ring-photo" aria-hidden="true">
        <img id="loveCircleImage" src="assets/images/distanceDosentMatter.jpg" alt="Our memory">
        <svg class="love-ring-overlay" viewBox="0 0 120 120" role="img">
          <defs>
            <path id="loveCirclePath" d="M60,60 m-42,0 a42,42 0 1,1 84,0 a42,42 0 1,1 -84,0"></path>
          </defs>
          <!-- <circle cx="60" cy="60" r="35" fill="rgba(255,255,255,0.18)"></circle> -->
          <!-- <text font-size="8.5" font-family="'Playfair Display', serif" fill="#ffffff" letter-spacing="1.2"> -->
            <!-- <textPath href="#loveCirclePath">I</textPath> -->
          </text>
        </svg>
      </div>
      <h2 class="love-script">i love you</h2>
    </div>
<p>
  My darling, my love, my wifeyyy, my happiness üíñ  
  Whenever I see your face, and whenever I see you smile, it fills my heart with a joy that words can never fully express.  
  In that moment, everything changes‚Äîfrom where I am to becoming the happiest man alive ü•πüí´ </br>  

  Just having you by my side brings me so much peace and comfort.  
  No language is powerful enough to describe the sukoon I feel because of you ü§ç  
  I want you to know that no matter what, I will always do my best to protect that beautiful smile,  
  that pure heart, and that gentle soul of yours üíû  </br>

  A heart that belongs to me,  
  a smile I crave every day,  
  and a soul I want to hold and protect forever in my arms ü´Ç‚ú®</br>  

  Promises can be broken,  
  but a promise made from one heart to another can never be.  
  It finds sweetness even in sorrow,  
  happiness even in sadness,  
  and meaning even in silence 
  It seeks for the solutions üíó </br>

  This is a promise of hearts‚Äî  
  not just for one lifetime,  
  but for all lifetimes,  
  across every form of existence, till eternity ‚ôæÔ∏èüíç </br> 

  An unbreakable bond of Khushbu and Vid ‚Äî ‚ÄúKhushVid‚Äù üíï  
  A bond written and blessed by God himself üôè‚ú®</br>  

  I love you, my love üíñ  
  I love you dheer saaraaa ü•∞  
  I love you forever, and ever, and ever ‚ôæÔ∏èüíû  </br>

  You are my strength, my calm, and my everything üíó  
  I promise to choose you every single day,  
  to love you endlessly,  
  and to stand by you forever ü´∂  </br>

  Happy Promise Day, my love üíêüíç
</p>

    <div class="love-stamp">&#128150; &#128139; &#127801; &#10024;</div>
  </div>

  <!-- üéÅ FULL CARD SCRATCH COVER -->
  <canvas id="scratchCanvas"></canvas>

</div>

<button class="next-btn" onclick="location.href='hugday.html'">Next ‚ûú</button>

<script src="js/script.js"></script>
<script>
const card = document.querySelector(".card");
const canvas = document.getElementById("scratchCanvas");
const ctx = canvas.getContext("2d");
let scratching = false;
let strokeCount = 0;
let revealed = false;
let lastBurstAt = 0;
let slideIndex = 0;

const photoSlides = [
  "assets/images/promiseday/IMG20251223102941.jpg",
  "assets/images/promiseday/IMG20251223103142.jpg",
  "assets/images/promiseday/IMG20251223103150.jpg",
  "assets/images/promiseday/IMG20251223103118.jpg",
  "assets/images/promiseday/IMG20251114095610.jpg",
  "assets/images/promiseday/IMG20251114095621.jpg",
  "assets/images/promiseday/IMG20251114095519.jpg",
  "assets/images/promiseday/IMG20251114095445.jpg",
  "assets/images/promiseday/IMG20251114095326.jpg",
  "assets/images/promiseday/IMG20250930095556.jpg",
  "assets/images/promiseday/IMG20250602192904.jpg",
  "assets/images/promiseday/IMG20250602192929.jpg",
  "assets/images/promiseday/IMG20250602193033.jpg"
];

/* ===== CANVAS SETUP (CRITICAL FIX) ===== */
function setupCanvas() {
  if (revealed) return;

  const rect = card.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;

  // RESET TRANSFORM (VERY IMPORTANT)
  ctx.setTransform(1, 0, 0, 1, 0, 0);

  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  canvas.style.width = rect.width + "px";
  canvas.style.height = rect.height + "px";

  ctx.scale(dpr, dpr);
  ctx.globalCompositeOperation = "source-over";

  // Romantic full-card wrap
  const grad = ctx.createLinearGradient(0, 0, rect.width, rect.height);
  grad.addColorStop(0, "#ff9a9e");
  grad.addColorStop(0.5, "#fad0c4");
  grad.addColorStop(1, "#fbc2eb");

  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, rect.width, rect.height);

  // Soft romantic pattern
  ctx.fillStyle = "rgba(255,255,255,0.35)";
  for (let i = 0; i < 350; i++) {
    ctx.beginPath();
    ctx.arc(
      Math.random() * rect.width,
      Math.random() * rect.height,
      Math.random() * 2 + 1,
      0, Math.PI * 2
    );
    ctx.fill();
  }

  drawScratchGreeting(rect.width, rect.height);
}

function drawScratchGreeting(width, height) {
  const ribbonY = Math.max(86, height * 0.15);
  const ribbonH = Math.max(58, height * 0.09);
  const ribbonX = width * 0.11;
  const ribbonW = width * 0.78;

  // Ribbon shadow
  ctx.fillStyle = "rgba(116, 29, 74, 0.28)";
  ctx.fillRect(ribbonX + 6, ribbonY + 8, ribbonW, ribbonH);

  // Ribbon bar
  const ribbonGrad = ctx.createLinearGradient(ribbonX, ribbonY, ribbonX + ribbonW, ribbonY + ribbonH);
  ribbonGrad.addColorStop(0, "#ff4f9c");
  ribbonGrad.addColorStop(0.45, "#d92f89");
  ribbonGrad.addColorStop(1, "#a42672");
  ctx.fillStyle = ribbonGrad;
  ctx.fillRect(ribbonX, ribbonY, ribbonW, ribbonH);

  // Ribbon tails
  ctx.beginPath();
  ctx.moveTo(ribbonX, ribbonY + ribbonH * 0.16);
  ctx.lineTo(ribbonX - width * 0.045, ribbonY + ribbonH * 0.5);
  ctx.lineTo(ribbonX, ribbonY + ribbonH * 0.84);
  ctx.closePath();
  ctx.fill();

  ctx.beginPath();
  ctx.moveTo(ribbonX + ribbonW, ribbonY + ribbonH * 0.16);
  ctx.lineTo(ribbonX + ribbonW + width * 0.045, ribbonY + ribbonH * 0.5);
  ctx.lineTo(ribbonX + ribbonW, ribbonY + ribbonH * 0.84);
  ctx.closePath();
  ctx.fill();

  // Ribbon shine
  ctx.fillStyle = "rgba(255, 190, 227, 0.55)";
  ctx.fillRect(ribbonX + width * 0.03, ribbonY + ribbonH * 0.12, ribbonW - width * 0.06, ribbonH * 0.2);
  ctx.fillStyle = "rgba(255, 255, 255, 0.18)";
  ctx.fillRect(ribbonX + ribbonW * 0.2, ribbonY + ribbonH * 0.22, ribbonW * 0.6, ribbonH * 0.56);

  // Greeting text
  ctx.textAlign = "center";
  ctx.shadowColor = "rgba(201, 40, 112, 0.45)";
  ctx.shadowBlur = 14;
  ctx.fillStyle = "rgba(255, 249, 253, 0.99)";
  ctx.font = `700 ${Math.max(30, width * 0.068)}px "Brush Script MT", "Segoe Script", cursive`;
  ctx.fillText("Happy Promise Day", width / 2, ribbonY + ribbonH + Math.max(70, height * 0.105));

  ctx.font = `700 ${Math.max(24, width * 0.05)}px "Brush Script MT", "Segoe Script", cursive`;
  ctx.fillText("My Love, Meri Khushbu", width / 2, ribbonY + ribbonH + Math.max(113, height * 0.165));
    ctx.fillText("Meri pyaari si jaan", width / 2, ribbonY + ribbonH + Math.max(150, height * 0.165));
        ctx.fillText("Mwah mwah mwah ", width / 2, ribbonY + ribbonH + Math.max(180, height * 0.165));
                ctx.fillText("üíãüíãüíãüíãüíóü´Ç", width / 2, ribbonY + ribbonH + Math.max(210, height * 0.165));
  ctx.shadowBlur = 0;

  // Heart emojis (kept away from text to avoid overlap)
  const y1 = ribbonY + ribbonH + Math.max(70, height * 0.105);
  const y2 = ribbonY + ribbonH + Math.max(113, height * 0.165);
  const emojiSize = Math.max(20, width * 0.04);
  ctx.font = `${emojiSize}px "Segoe UI Emoji", "Apple Color Emoji", sans-serif`;
  ctx.fillText("üíñ", width * 0.12, y1 - 2);
  ctx.fillText("üíò", width * 0.88, y1 - 2);
  ctx.fillText("üíï", width * 0.12, y2 + 4);
  ctx.fillText("üíû", width * 0.88, y2 + 4);

  // Sparkles
  ctx.fillStyle = "rgba(255, 255, 255, 0.85)";
  for (let i = 0; i < 14; i++) {
    const sx = width * (0.2 + Math.random() * 0.6);
    const sy = ribbonY + ribbonH + Math.max(24, height * 0.045) + Math.random() * Math.max(120, height * 0.18);
    ctx.beginPath();
    ctx.arc(sx, sy, Math.random() * 1.8 + 0.8, 0, Math.PI * 2);
    ctx.fill();
  }
}

requestAnimationFrame(setupCanvas);
window.addEventListener("resize", setupCanvas);
initPhotoSlider();

function initPhotoSlider() {
  const slide = document.getElementById("loveCircleImage");
  if (!slide || photoSlides.length === 0) return;

  slide.src = encodeURI(photoSlides[0]);

  setInterval(() => {
    slide.style.opacity = "0";

    setTimeout(() => {
      slideIndex = (slideIndex + 1) % photoSlides.length;
      slide.src = encodeURI(photoSlides[slideIndex]);
      slide.style.opacity = "1";
    }, 220);
  }, 2600);
}

/* ===== POINTER EVENTS ===== */
canvas.addEventListener("pointerdown", (e) => {
  scratching = true;
  canvas.setPointerCapture(e.pointerId);
  scratch(e);
});
canvas.addEventListener("pointerup", (e) => {
  scratching = false;
  if (canvas.hasPointerCapture(e.pointerId)) {
    canvas.releasePointerCapture(e.pointerId);
  }
});
canvas.addEventListener("pointercancel", (e) => {
  scratching = false;
  if (canvas.hasPointerCapture(e.pointerId)) {
    canvas.releasePointerCapture(e.pointerId);
  }
});
canvas.addEventListener("pointerleave", () => scratching = false);
canvas.addEventListener("pointermove", scratch);

/* ===== SCRATCH LOGIC ===== */

function scratch(e) {
  if (!scratching || revealed) return;

  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  ctx.globalCompositeOperation = "destination-out";
  ctx.beginPath();
  ctx.arc(x, y, 45, 0, Math.PI * 2);
  ctx.fill();

  const now = performance.now();
  if (now - lastBurstAt > 120) {
    burstFromTop();
    lastBurstAt = now;
  }

  strokeCount += 1;
  if (strokeCount % 8 === 0 && getRevealRatio() > 0.48) {
    revealCard();
  }
}

function getRevealRatio() {
  const step = 14;
  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
  let sampled = 0;
  let transparent = 0;

  for (let y = 0; y < canvas.height; y += step) {
    for (let x = 0; x < canvas.width; x += step) {
      sampled += 1;
      const alpha = data[(y * canvas.width + x) * 4 + 3];
      if (alpha < 35) transparent += 1;
    }
  }
  return sampled ? transparent / sampled : 0;
}

function revealCard() {
  revealed = true;
  canvas.style.animation = "none";
  canvas.style.transition = "opacity 350ms ease";
  canvas.style.opacity = "0";
  burstCelebrationEmojis();
  setTimeout(() => {
    canvas.style.pointerEvents = "none";
  }, 350);
}

function burstCelebrationEmojis() {
  const cardRect = card.getBoundingClientRect();
  const cx = cardRect.left + cardRect.width / 2;
  const cy = cardRect.top + cardRect.height / 2;
  const emojis = ["üëè", "ü•≥", "üòä", "‚ù§Ô∏è", "üíñ", "üòò", "üíã"];
  const count = 34;

  for (let i = 0; i < count; i++) {
    const el = document.createElement("span");
    el.className = "emoji-pop";
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    el.style.left = cx + "px";
    el.style.top = cy + "px";

    const angle = (Math.PI * 2 * i) / count + Math.random() * 0.4;
    const distance = 70 + Math.random() * 170;
    el.style.setProperty("--dx", `${Math.cos(angle) * distance}px`);
    el.style.setProperty("--dy", `${Math.sin(angle) * distance}px`);
    el.style.animationDelay = `${Math.random() * 0.15}s`;

    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1500);
  }
}

/* ===== PARTY PUFFER FROM TOP ===== */
function burstFromTop() {
  const cardRect = document.querySelector('.card').getBoundingClientRect();

  for (let i = 0; i < 14; i++) {
    const c = document.createElement("div");
    c.className = "confetti";

    c.style.left =
      cardRect.left + Math.random() * cardRect.width + "px";
    c.style.top = cardRect.top + "px";

    c.style.background =
      `hsl(${Math.random() * 360},100%,60%)`;

    c.style.animationDuration =
      (Math.random() * 1.5 + 1.5) + "s";

    document.body.appendChild(c);
    setTimeout(() => c.remove(), 2800);
  }
}
</script>

</body>
</html>
